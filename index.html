<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>1403 Vision Scouting App</title>
<style>
:root {
  --green: #2d6a4f;
  --green-light: #40916c;
  --green-dark: #1b4332;
  --green-faint: #d8f3dc;
  --white: #ffffff;
  --danger: #c0392b;
}
[data-theme="dark"] {
  --bg: #0d1f17;
  --bg2: #152a1e;
  --bg3: #1e3a2a;
  --border: #2d6a4f;
  --text: #e8f5e9;
  --text2: #a5d6a7;
  --text3: #66bb6a;
  --card-shadow: 0 2px 8px rgba(0,0,0,0.5);
  --toggle-bg: #1b4332;
  --input-bg: #0d1f17;
  --header-bg: #0a1a10;
}
.stepper-val::-webkit-inner-spin-button,
.stepper-val::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
.stepper-val { -moz-appearance: textfield; }
[data-theme="light"] {
  --bg: #f1f8f4;
  --bg2: #ffffff;
  --bg3: #d8f3dc;
  --border: #40916c;
  --text: #1b4332;
  --text2: #2d6a4f;
  --text3: #40916c;
  --card-shadow: 0 2px 8px rgba(0,0,0,0.1);
  --toggle-bg: #b7e4c7;
  --input-bg: #f9fdf9;
  --header-bg: #1b4332;
}
[data-theme="cute"] {
  --bg: #fff0f6;
  --bg2: #ffffff;
  --bg3: #ffd6e8;
  --border: #f78db8;
  --text: #6b2d4e;
  --text2: #c2185b;
  --text3: #e91e8c;
  --card-shadow: 0 2px 8px rgba(247,141,184,0.2);
  --toggle-bg: #ffc0d9;
  --input-bg: #fff8fb;
  --header-bg: #f06292;
  --green: #f06292;
  --green-light: #f78db8;
  --green-dark: #c2185b;
  --green-faint: #ffd6e8;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; transition: background 0.2s, color 0.2s; }

/* HEADER */
header { background: var(--header-bg); color: #fff; padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between; border-bottom: 3px solid var(--green-light); position: sticky; top: 0; z-index: 100; }
header h1 { font-size: 1.3rem; font-weight: 800; letter-spacing: 0.02em; }
header h1 span { color: #74c69d; }
.theme-btn { background: var(--bg3); border: 2px solid var(--green-light); color: var(--text3); border-radius: 8px; padding: 0.4rem 0.85rem; font-size: 0.85rem; font-weight: 700; cursor: pointer; transition: all 0.2s; }
.theme-btn:hover { background: var(--green); color: #fff; }

/* LAYOUT */
.page { max-width: 700px; margin: 0 auto; padding: 1.2rem 1rem 5rem; }

/* SECTION CARD */
.card { background: var(--bg2); border: 1.5px solid var(--border); border-radius: 12px; padding: 1.25rem 1.25rem 1rem; margin-bottom: 1.1rem; box-shadow: var(--card-shadow); }
.card-title { font-size: 0.72rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text3); margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1.5px solid var(--border); }

/* FIELD ROW */
.field { margin-bottom: 0.9rem; }
.field:last-child { margin-bottom: 0; }
.field-label-row { display: flex; align-items: center; gap: 0.4rem; margin-bottom: 0.35rem; }
.field-label-row label { font-size: 0.9rem; font-weight: 700; color: var(--text); }
.req { color: #ff6b6b; font-size: 0.85rem; }
.info-btn { width: 20px; height: 20px; border-radius: 50%; border: 1.5px solid var(--text3); background: transparent; color: var(--text3); font-size: 0.7rem; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.15s; }
.info-btn:hover { background: var(--green); color: #fff; border-color: var(--green); }

/* INPUTS */
input[type="text"], textarea, select {
  width: 100%; padding: 0.65rem 0.85rem; border: 2px solid var(--border); border-radius: 8px;
  font-size: 1rem; color: var(--text); background: var(--input-bg); transition: border-color 0.2s;
  -webkit-appearance: none;
}
input[type="text"]:focus, textarea:focus, select:focus { outline: none; border-color: var(--green-light); }
textarea { resize: vertical; min-height: 90px; font-family: inherit; }
select option { background: var(--bg2); }

/* STEPPER */
.stepper { display: flex; align-items: center; gap: 0; border: 2px solid var(--border); border-radius: 8px; overflow: hidden; width: 100%; }
.stepper-btn { background: var(--bg3); border: none; color: var(--text); font-size: 1.2rem; font-weight: 700; width: 38px; height: 44px; cursor: pointer; flex-shrink: 0; transition: background 0.15s; display: flex; align-items: center; justify-content: center; }
.stepper-btn:hover { background: var(--green); color: #fff; }
.stepper-btn:active { background: var(--green-dark); }
.stepper-val { flex: 1; text-align: center; font-size: 1rem; font-weight: 700; color: var(--text); background: var(--input-bg); border: none; height: 44px; outline: none; min-width: 0; }
.row2 .stepper-btn { width: 32px; height: 40px; font-size: 1.1rem; }
.row2 .stepper-val { height: 40px; font-size: 0.95rem; }

/* BOOLEAN TOGGLE */
.bool-row { display: flex; align-items: center; justify-content: space-between; gap: 1rem; }
.bool-row .field-label-row { margin-bottom: 0; flex: 1; }
.toggle { position: relative; width: 56px; height: 30px; flex-shrink: 0; }
.toggle input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; inset: 0; background: var(--toggle-bg); border: 2px solid var(--border); border-radius: 30px; cursor: pointer; transition: background 0.2s, border-color 0.2s; }
.slider:before { content: ''; position: absolute; width: 22px; height: 22px; left: 2px; top: 2px; background: var(--text2); border-radius: 50%; transition: transform 0.2s, background 0.2s; }
.toggle input:checked + .slider { background: var(--green); border-color: var(--green-light); }
.toggle input:checked + .slider:before { transform: translateX(26px); background: #fff; }

/* ROW2 */
.row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 0.85rem; }

/* TIMER */
.timer-display { font-size: 2.2rem; font-weight: 800; text-align: center; color: var(--text3); font-variant-numeric: tabular-nums; letter-spacing: 0.05em; margin: 0.5rem 0; }
.timer-btns { display: flex; gap: 0.6rem; }
.timer-btn { flex: 1; padding: 0.75rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: opacity 0.2s, transform 0.1s; }
.timer-btn:active { transform: scale(0.97); }
.btn-start { background: var(--green); color: #fff; }
.btn-pause { background: #e67e22; color: #fff; }
.btn-reset-t { background: var(--bg3); color: var(--text); border: 2px solid var(--border); }

/* COLLAPSED SECTION */
.collapsible { overflow: hidden; transition: max-height 0.4s ease, opacity 0.4s ease; max-height: 9999px; opacity: 1; }
.collapsible.collapsed { max-height: 0; opacity: 0; pointer-events: none; }

/* TOOLTIP MODAL */
.modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 200; align-items: center; justify-content: center; padding: 1.5rem; }
.modal-overlay.open { display: flex; }
.modal { background: var(--bg2); border: 2px solid var(--green-light); border-radius: 14px; padding: 1.5rem; max-width: 420px; width: 100%; box-shadow: 0 8px 32px rgba(0,0,0,0.5); }
.modal h3 { color: var(--text3); font-size: 1rem; margin-bottom: 0.6rem; }
.modal p { color: var(--text); font-size: 0.92rem; line-height: 1.5; }
.modal-close { margin-top: 1.1rem; width: 100%; padding: 0.7rem; background: var(--green); color: #fff; border: none; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer; }

/* GENERATE / RESET BUTTONS */
.action-btns { display: flex; flex-direction: column; gap: 0.75rem; margin-top: 0.5rem; }
.gen-btn { padding: 1rem; background: var(--green); color: #fff; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 800; cursor: pointer; transition: background 0.2s, transform 0.1s; letter-spacing: 0.03em; }
.gen-btn:hover { background: var(--green-light); }
.gen-btn:active { transform: scale(0.98); }
.rst-btn { padding: 0.8rem; background: transparent; color: var(--text2); border: 2px solid var(--border); border-radius: 10px; font-size: 0.95rem; font-weight: 700; cursor: pointer; transition: all 0.2s; }
.rst-btn:hover { border-color: var(--danger); color: var(--danger); }

/* QR OUTPUT */
#qrOutput { display: none; text-align: center; margin-top: 1.1rem; background: var(--bg2); border: 1.5px solid var(--border); border-radius: 12px; padding: 1.5rem; }
#qrOutput p { font-size: 0.82rem; color: var(--text2); margin-top: 0.75rem; }
#qrCanvas { border: 4px solid var(--green); border-radius: 10px; }

/* DIED DEPENDENT */
.dep-fields { background: var(--bg3); border-radius: 8px; padding: 0.85rem; margin-top: 0.75rem; border: 1.5px dashed var(--border); }

@media (max-width: 480px) { .row2 { grid-template-columns: 1fr; } header h1 { font-size: 1.05rem; } }
</style>
</head>
<body>
<header>
  <h1><span>1403</span> Vision Scouting App</h1>
  <button class="theme-btn" onclick="toggleTheme()" id="themeBtn">‚òÄÔ∏è Light</button>
</header>

<div class="page">

  <!-- PREMATCH -->
  <div class="card">
    <div class="card-title">‚ö° Prematch Information</div>

    <div class="field">
      <div class="field-label-row">
        <label>Name <span class="req">*</span></label>
        <button class="info-btn" onclick="showInfo('Name','The name of the scouter filling out this form. This field is NOT reset between matches.')">i</button>
      </div>
      <input type="text" id="f_name" placeholder="Your name">
    </div>

    <div class="field">
      <div class="field-label-row">
        <label>Match Number <span class="req">*</span></label>
        <button class="info-btn" onclick="showInfo('Match Number','The current match number being scouted. Use + / ‚àí to increment. Minimum value: 0. Resets after submission.')">i</button>
      </div>
      <div class="stepper">
        <button class="stepper-btn" onclick="step('f_match',-1)">‚àí</button>
        <input class="stepper-val" type="number" id="f_match" value="0" min="0" onchange="clamp('f_match',0)">
        <button class="stepper-btn" onclick="step('f_match',1)">+</button>
      </div>
    </div>
    <div class="field">
      <div class="field-label-row">
        <label>Team Number <span class="req">*</span></label>
        <button class="info-btn" onclick="showInfo('Team Number','The FRC team number of the robot being scouted. Minimum value: 0. Resets after submission.')">i</button>
      </div>
      <div class="stepper">
        <button class="stepper-btn" onclick="step('f_team',-1)">‚àí</button>
        <input class="stepper-val" type="number" id="f_team" value="0" min="0" onchange="clamp('f_team',0)">
        <button class="stepper-btn" onclick="step('f_team',1)">+</button>
      </div>
    </div>

    <div class="field">
      <div class="field-label-row">
        <label>Scouting Position <span class="req">*</span></label>
        <button class="info-btn" onclick="showInfo('Scouting Position','Which alliance position this scouter is assigned to. Red 1/2/3 or Blue 1/2/3. Defaults to Red 1. Resets after submission.')">i</button>
      </div>
      <select id="f_pos">
        <option value="Red 1" selected>Red 1</option>
        <option value="Red 2">Red 2</option>
        <option value="Red 3">Red 3</option>
        <option value="Blue 1">Blue 1</option>
        <option value="Blue 2">Blue 2</option>
        <option value="Blue 3">Blue 3</option>
      </select>
    </div>

    <div class="field">
      <div class="bool-row">
        <div class="field-label-row">
          <label>Showed Up? <span class="req">*</span></label>
          <button class="info-btn" onclick="showInfo('Showed Up?','Whether the team actually appeared on the field for this match. If set to No, the rest of the form will collapse. Default: Yes. Resets after submission.')">i</button>
        </div>
        <label class="toggle"><input type="checkbox" id="f_showed" checked onchange="toggleShowedUp()"><span class="slider"></span></label>
      </div>
    </div>

    <div class="collapsible" id="mainForm">
      <div class="field" style="margin-top:0.6rem;">
        <div class="field-label-row">
          <label>Starting Side <span class="req">*</span></label>
          <button class="info-btn" onclick="showInfo('Starting Side','Which side of the field the robot starts on at the beginning of the match. Options: Center, Depot Side, Non-Depot Side. Resets after submission.')">i</button>
        </div>
        <select id="f_startside">
          <option value="Center" selected>Center</option>
          <option value="Depot Side">Depot Side</option>
          <option value="Non-Depot Side">Non-Depot Side</option>
        </select>
      </div>

      <div class="field">
        <div class="field-label-row">
          <label>Match Timer</label>
          <button class="info-btn" onclick="showInfo('Match Timer','Start this timer at the beginning of the match. It records timestamps used for the Died/Functioning Again fields. You can pause and reset it.')">i</button>
        </div>
        <div class="timer-display" id="timerDisplay">0:00</div>
        <div class="timer-btns">
          <button class="timer-btn btn-start" id="timerStartBtn" onclick="timerToggle()">‚ñ∂ Start</button>
          <button class="timer-btn btn-reset-t" onclick="timerReset()">‚Ü∫ Reset</button>
        </div>
      </div>

      <!-- AUTO -->
      <div class="card-title" style="margin-top:1rem;">ü§ñ Autonomous</div>

      <div class="field">
        <div class="bool-row">
          <div class="field-label-row">
            <label>Climbed Tower?</label>
            <button class="info-btn" onclick="showInfo('Climbed Tower? (Auto)','Did the robot successfully climb the tower during autonomous? Default: No. Resets after submission.')">i</button>
          </div>
          <label class="toggle"><input type="checkbox" id="f_climbed"><span class="slider"></span></label>
        </div>
      </div>
      <div class="field">
        <div class="bool-row">
          <div class="field-label-row">
            <label>Attempted Climb (Unsuccessful)?</label>
            <button class="info-btn" onclick="showInfo('Attempted Climb (Unsuccessful)?','Did the robot attempt to climb the tower during auto but fail to complete it? Resets after submission.')">i</button>
          </div>
          <label class="toggle"><input type="checkbox" id="f_attempted_climb"><span class="slider"></span></label>
        </div>
      </div>

      <div class="row2">
        <div class="field">
          <div class="field-label-row"><label>Fuel Scored (Auto)</label><button class="info-btn" onclick="showInfo('Fuel Scored (Auto)','Number of fuel game pieces successfully scored by the robot during autonomous. Minimum: 0. Resets after submission.')">i</button></div>
          <div class="stepper"><button class="stepper-btn" onclick="step('f_fuel_scored',-4)">‚àí</button><input class="stepper-val" type="number" id="f_fuel_scored" value="0" min="0" onchange="clamp('f_fuel_scored',0)"><button class="stepper-btn" onclick="step('f_fuel_scored',4)">+</button></div>
        </div>
        <div class="field">
          <div class="field-label-row"><label>Fuel Missed (Auto)</label><button class="info-btn" onclick="showInfo('Fuel Missed (Auto)','Number of fuel game pieces attempted but missed during autonomous. Minimum: 0. Resets after submission.')">i</button></div>
          <div class="stepper"><button class="stepper-btn" onclick="step('f_fuel_missed',-4)">‚àí</button><input class="stepper-val" type="number" id="f_fuel_missed" value="0" min="0" onchange="clamp('f_fuel_missed',0)"><button class="stepper-btn" onclick="step('f_fuel_missed',4)">+</button></div>
        </div>
      </div>
      <div class="row2">
        <div class="field">
          <div class="field-label-row"><label>Fuel Shot/Fed (Auto)</label><button class="info-btn" onclick="showInfo('Fuel Shot/Fed (Auto)','Number of fuel game pieces shot or fed during autonomous. Minimum: 0. Resets after submission.')">i</button></div>
          <div class="stepper"><button class="stepper-btn" onclick="step('f_fuel_shotfed',-4)">‚àí</button><input class="stepper-val" type="number" id="f_fuel_shotfed" value="0" min="0" onchange="clamp('f_fuel_shotfed',0)"><button class="stepper-btn" onclick="step('f_fuel_shotfed',4)">+</button></div>
        </div>
        <div class="field">
          <div class="field-label-row"><label>HP Fuel Scored (Auto)</label><button class="info-btn" onclick="showInfo('Human Player Fuel Scored (Auto)','Number of fuel game pieces scored by the human player during autonomous. Minimum: 0.')">i</button></div>
          <div class="stepper"><button class="stepper-btn" onclick="step('f_hp_fuel',-1)">‚àí</button><input class="stepper-val" type="number" id="f_hp_fuel" value="0" min="0" onchange="clamp('f_hp_fuel',0)"><button class="stepper-btn" onclick="step('f_hp_fuel',1)">+</button></div>
        </div>
      </div>
      <div class="row2">
        <div class="field">
          <div class="field-label-row"><label>Crossed Bump?</label><button class="info-btn" onclick="showInfo('Crossed Bump?','Number of times the robot crossed the bump during autonomous. Minimum: 0. Resets after submission.')">i</button></div>
          <div class="stepper"><button class="stepper-btn" onclick="step('f_bump',-1)">‚àí</button><input class="stepper-val" type="number" id="f_bump" value="0" min="0" onchange="clamp('f_bump',0)"><button class="stepper-btn" onclick="step('f_bump',1)">+</button></div>
        </div>
        <div class="field">
          <div class="field-label-row"><label>Crossed Trench?</label><button class="info-btn" onclick="showInfo('Crossed Trench?','Number of times the robot crossed the trench during autonomous. Minimum: 0. Resets after submission.')">i</button></div>
          <div class="stepper"><button class="stepper-btn" onclick="step('f_trench',-1)">‚àí</button><input class="stepper-val" type="number" id="f_trench" value="0" min="0" onchange="clamp('f_trench',0)"><button class="stepper-btn" onclick="step('f_trench',1)">+</button></div>
        </div>
      </div>

      <!-- TELEOP -->
      <div class="card-title" style="margin-top:1rem;">üïπÔ∏è Teleop</div>

      <div class="row2">
        <div class="field">
          <div class="field-label-row"><label>Fuel Scored (Teleop)</label><button class="info-btn" onclick="showInfo('Fuel Scored (Teleop)','Number of fuel game pieces scored during teleop. Minimum: 0. Resets after submission.')">i</button></div>
          <div class="stepper"><button class="stepper-btn" onclick="step('f_fuel_scored_t',-4)">‚àí</button><input class="stepper-val" type="number" id="f_fuel_scored_t" value="0" min="0" onchange="clamp('f_fuel_scored_t',0)"><button class="stepper-btn" onclick="step('f_fuel_scored_t',4)">+</button></div>
        </div>
        <div class="field">
          <div class="field-label-row"><label>Fuel Fed (Teleop)</label><button class="info-btn" onclick="showInfo('Fuel Fed (Teleop)','Number of fuel game pieces fed during teleop. Minimum: 0. Resets after submission.')">i</button></div>
          <div class="stepper"><button class="stepper-btn" onclick="step('f_fuel_fed_t',-1)">‚àí</button><input class="stepper-val" type="number" id="f_fuel_fed_t" value="0" min="0" onchange="clamp('f_fuel_fed_t',0)"><button class="stepper-btn" onclick="step('f_fuel_fed_t',1)">+</button></div>
        </div>
      </div>
      <div class="field">
        <div class="field-label-row"><label>HP Fuel Scored (Teleop)</label><button class="info-btn" onclick="showInfo('Human Player Fuel Scored (Teleop)','Number of fuel game pieces scored by the human player during teleop. Minimum: 0. Resets after submission.')">i</button></div>
        <div class="stepper"><button class="stepper-btn" onclick="step('f_hp_fuel_t',-1)">‚àí</button><input class="stepper-val" type="number" id="f_hp_fuel_t" value="0" min="0" onchange="clamp('f_hp_fuel_t',0)"><button class="stepper-btn" onclick="step('f_hp_fuel_t',1)">+</button></div>
      </div>
      <div class="field">
        <div class="bool-row">
          <div class="field-label-row">
            <label>Crossed Field / Played Defense?</label>
            <button class="info-btn" onclick="showInfo('Crossed Field / Played Defense?','Did the robot cross the field or play defense during teleop?')">i</button>
          </div>
          <label class="toggle"><input type="checkbox" id="f_defense"><span class="slider"></span></label>
        </div>
      </div>

      <!-- ENDGAME -->
      <div class="card-title" style="margin-top:1rem;">üèÅ Endgame</div>

      <div class="field">
        <div class="field-label-row">
          <label>Climbed Tower (Endgame)</label>
          <button class="info-btn" onclick="showInfo('Climbed Tower (Endgame)','The result of the robot\'s tower climb at the end of the match. Options: Didn\'t Climb, Unsuccessfully Attempted Climb, Level 1, Level 2, Level 3.')">i</button>
        </div>
        <select id="f_climb_end">
          <option value="Didn't Climb" selected>Didn't Climb</option>
          <option value="Unsuccessfully Attempted Climb">Unsuccessfully Attempted Climb</option>
          <option value="Level 1">Level 1</option>
          <option value="Level 2">Level 2</option>
          <option value="Level 3">Level 3</option>
        </select>
      </div>
      <div class="field">
        <div class="bool-row">
          <div class="field-label-row">
            <label>Kept Scoring / Playing Until End?</label>
            <button class="info-btn" onclick="showInfo('Kept Scoring / Playing Until End?','Did the robot continue actively scoring or playing until the match ended?')">i</button>
          </div>
          <label class="toggle"><input type="checkbox" id="f_kept_scoring"><span class="slider"></span></label>
        </div>
      </div>

      <!-- POSTMATCH -->
      <div class="card-title" style="margin-top:1rem;">üìã Postmatch</div>

      <div class="field">
        <div class="bool-row">
          <div class="field-label-row">
            <label>Died?</label>
            <button class="info-btn" onclick="showInfo('Died?','Did the robot lose battery, stop functioning, or otherwise die during the match? Enabling this will reveal timestamp fields. Default: No. Resets after submission.')">i</button>
          </div>
          <label class="toggle"><input type="checkbox" id="f_died" onchange="toggleDied()"><span class="slider"></span></label>
        </div>
        <div class="dep-fields collapsible collapsed" id="diedFields">
          <div class="field" style="margin-bottom:0.75rem;">
            <div class="bool-row">
              <div class="field-label-row">
                <label>Approx. Time Robot Died</label>
                <button class="info-btn" onclick="showInfo('Approx. Time Robot Died','Timestamp (from the match timer) at which the robot died. Click the button to record the current timer value. Always included in QR output.')">i</button>
              </div>
              <button class="timer-btn btn-pause" style="width:auto;padding:0.4rem 0.9rem;font-size:0.85rem;" onclick="stampDied()">üìå Stamp</button>
            </div>
            <input type="text" id="f_time_died" placeholder="Timer not running" readonly style="margin-top:0.4rem;background:var(--bg3);">
          </div>
          <div class="field" style="margin-bottom:0;">
            <div class="bool-row">
              <div class="field-label-row">
                <label>Functioning Again?</label>
                <button class="info-btn" onclick="showInfo('Functioning Again?','Did the robot start functioning again after dying? Click Stamp to record the timer timestamp. Always included in QR output.')">i</button>
              </div>
              <button class="timer-btn btn-start" style="width:auto;padding:0.4rem 0.9rem;font-size:0.85rem;" onclick="stampFunctioning()">üìå Stamp</button>
            </div>
            <input type="text" id="f_functioning" placeholder="Timer not running" readonly style="margin-top:0.4rem;background:var(--bg3);">
          </div>
        </div>
      </div>

      <div class="field">
        <div class="bool-row">
          <div class="field-label-row">
            <label>Tipped Over?</label>
            <button class="info-btn" onclick="showInfo('Tipped Over?','Did the robot tip over and become unable to play during the match? Default: No. Resets after submission.')">i</button>
          </div>
          <label class="toggle"><input type="checkbox" id="f_tipped"><span class="slider"></span></label>
        </div>
      </div>

    </div><!-- end collapsible mainForm -->

    <div class="field" style="margin-top:0.75rem;">
      <div class="field-label-row">
        <label>Comments <span class="req">*</span></label>
        <button class="info-btn" onclick="showInfo('Comments','Any additional observations about the robot or match. No character limit. Required field. Resets after submission.')">i</button>
      </div>
      <textarea id="f_comments" placeholder="Notes about the robot or match..."></textarea>
    </div>

  </div><!-- end card -->

  <div class="action-btns">
    <button class="gen-btn" id="genBtn" onclick="generateQR()" disabled style="opacity:0.4;cursor:not-allowed;">üì∑ Generate QR Code</button>
    <button class="rst-btn" onclick="resetForm()">‚Ü∫ Reset Form</button>
  </div>

  <div id="qrOutput">
    <canvas id="qrCanvas"></canvas>
    <p>Scan with your Bluetooth scanner ‚Äî tab-separated data fills across columns in Google Sheets</p>
  </div>

</div><!-- end page -->

<!-- INFO MODAL -->
<div class="modal-overlay" id="modal" onclick="closeModal(event)">
  <div class="modal">
    <h3 id="modalTitle"></h3>
    <p id="modalBody"></p>
    <button class="modal-close" onclick="closeInfoModal()">Got it</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
// REQUIRED FIELD VALIDATION
function checkRequired() {
  const name = document.getElementById('f_name').value.trim();
  const match = document.getElementById('f_match').value.trim();
  const team = document.getElementById('f_team').value.trim();
  const ready = name !== '' && match !== '' && team !== '';
  const btn = document.getElementById('genBtn');
  btn.disabled = !ready;
  btn.style.opacity = ready ? '1' : '0.4';
  btn.style.cursor = ready ? 'pointer' : 'not-allowed';
}
document.getElementById('f_name').addEventListener('input', checkRequired);
document.getElementById('f_match').addEventListener('input', checkRequired);
document.getElementById('f_team').addEventListener('input', checkRequired);

// THEME
function toggleTheme() {
  const html = document.documentElement;
  const cur = html.getAttribute('data-theme');
  const next = cur === 'dark' ? 'light' : cur === 'light' ? 'cute' : 'dark';
  html.setAttribute('data-theme', next);
  document.getElementById('themeBtn').textContent = next === 'dark' ? '‚òÄÔ∏è Light' : next === 'light' ? 'üå∏ Cute' : 'üåô Dark';
}

// STEPPER
function step(id, delta) {
  const el = document.getElementById(id);
  const v = parseInt(el.value) || 0;
  el.value = Math.max(0, v + delta);
}
function clamp(id, min) {
  const el = document.getElementById(id);
  if (parseInt(el.value) < min || el.value === '') el.value = min;
}

// TIMER
let timerSec = 0, timerRunning = false, timerInterval = null;
function timerToggle() {
  if (timerRunning) {
    clearInterval(timerInterval);
    timerRunning = false;
    document.getElementById('timerStartBtn').textContent = '‚ñ∂ Resume';
  } else {
    timerInterval = setInterval(() => {
      timerSec++;
      const m = Math.floor(timerSec/60), s = timerSec%60;
      document.getElementById('timerDisplay').textContent = m+':'+(s<10?'0':'')+s;
    }, 1000);
    timerRunning = true;
    document.getElementById('timerStartBtn').textContent = '‚è∏ Pause';
  }
}
function timerReset() {
  clearInterval(timerInterval);
  timerRunning = false;
  timerSec = 0;
  document.getElementById('timerDisplay').textContent = '0:00';
  document.getElementById('timerStartBtn').textContent = '‚ñ∂ Start';
}
function currentTimestamp() {
  const m = Math.floor(timerSec/60), s = timerSec%60;
  return m+':'+(s<10?'0':'')+s;
}
function stampDied() {
  document.getElementById('f_time_died').value = currentTimestamp();
}
function stampFunctioning() {
  document.getElementById('f_functioning').value = currentTimestamp();
}

// SHOWED UP COLLAPSE
function toggleShowedUp() {
  const showed = document.getElementById('f_showed').checked;
  document.getElementById('mainForm').classList.toggle('collapsed', !showed);
}

// DIED COLLAPSE
function toggleDied() {
  const died = document.getElementById('f_died').checked;
  document.getElementById('diedFields').classList.toggle('collapsed', !died);
}

// INFO MODAL
function showInfo(title, body) {
  document.getElementById('modalTitle').textContent = title;
  document.getElementById('modalBody').textContent = body;
  document.getElementById('modal').classList.add('open');
}
function closeInfoModal() { document.getElementById('modal').classList.remove('open'); }
function closeModal(e) { if (e.target === document.getElementById('modal')) closeInfoModal(); }

// QR GENERATION
function generateQR() {
  const fields = [
    document.getElementById('f_name').value,
    document.getElementById('f_match').value,
    document.getElementById('f_pos').value,
    document.getElementById('f_team').value,
    document.getElementById('f_showed').checked ? 'TRUE' : 'FALSE',
    document.getElementById('f_startside').value,
    String(timerSec),                                    // Timer Start (seconds elapsed)
    document.getElementById('f_climbed').checked ? 'TRUE' : 'FALSE',
    document.getElementById('f_attempted_climb').checked ? 'TRUE' : 'FALSE',
    document.getElementById('f_fuel_scored').value,
    document.getElementById('f_fuel_missed').value,
    document.getElementById('f_fuel_shotfed').value,
    document.getElementById('f_hp_fuel').value,
    document.getElementById('f_bump').value,
    document.getElementById('f_trench').value,
    document.getElementById('f_fuel_scored_t').value,
    document.getElementById('f_fuel_fed_t').value,
    document.getElementById('f_hp_fuel_t').value,
    document.getElementById('f_defense').checked ? 'TRUE' : 'FALSE',
    document.getElementById('f_climb_end').value,
    document.getElementById('f_kept_scoring').checked ? 'TRUE' : 'FALSE',
    document.getElementById('f_died').checked ? 'TRUE' : 'FALSE',
    document.getElementById('f_time_died').value || '0:00',   // always included, fallback to 0:00
    document.getElementById('f_functioning').value || 'FALSE', // always included, fallback to FALSE
    document.getElementById('f_tipped').checked ? 'TRUE' : 'FALSE',
    document.getElementById('f_comments').value,
  ];

  const text = fields.join('\t');
  const out = document.getElementById('qrOutput');
  const canvas = document.getElementById('qrCanvas');
  out.style.display = 'block';
  canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);

  const tmp = document.createElement('div');
  tmp.style.display = 'none';
  document.body.appendChild(tmp);
  new QRCode(tmp, { text, width: 300, height: 300, correctLevel: QRCode.CorrectLevel.M });

  setTimeout(() => {
    const img = tmp.querySelector('img') || tmp.querySelector('canvas');
    canvas.width = 300; canvas.height = 300;
    const ctx = canvas.getContext('2d');
    if (img.tagName === 'IMG') {
      const i = new Image(); i.onload = () => ctx.drawImage(i,0,0); i.src = img.src;
    } else { ctx.drawImage(img,0,0); }
    document.body.removeChild(tmp);
    out.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }, 100);
}

// RESET (keeps Name, resets everything else)
function resetForm() {
  document.getElementById('f_match').value = '0';
  document.getElementById('f_pos').value = 'Red 1';
  document.getElementById('f_team').value = '0';
  document.getElementById('f_showed').checked = true;
  document.getElementById('mainForm').classList.remove('collapsed');
  document.getElementById('f_startside').value = 'Center';
  timerReset();
  ['f_climbed','f_attempted_climb','f_defense','f_kept_scoring','f_died','f_tipped'].forEach(id => document.getElementById(id).checked = false);
  document.getElementById('diedFields').classList.add('collapsed');
  document.getElementById('f_time_died').value = '';
  document.getElementById('f_functioning').value = '';
  ['f_fuel_scored','f_fuel_missed','f_fuel_shotfed','f_hp_fuel','f_bump','f_trench',
   'f_fuel_scored_t','f_fuel_fed_t','f_hp_fuel_t'].forEach(id => document.getElementById(id).value = '0');
  document.getElementById('f_climb_end').value = "Didn't Climb";
  document.getElementById('f_comments').value = '';
  document.getElementById('qrOutput').style.display = 'none';
}
</script>
</body>
</html>
